<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Home of noocyte &#187; performance</title>
	<atom:link href="http://blog.noocyte.net/tag/performance/feed/" rel="self" type="application/rss+xml" />
	<link>http://blog.noocyte.net</link>
	<description>Ramblings of a mad mind</description>
	<lastBuildDate>Fri, 04 Apr 2014 13:39:58 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=4.2.2</generator>
	<item>
		<title>ORMs and Performance</title>
		<link>http://blog.noocyte.net/2012/09/07/orms-and-performance/</link>
		<comments>http://blog.noocyte.net/2012/09/07/orms-and-performance/#comments</comments>
		<pubDate>Fri, 07 Sep 2012 11:01:31 +0000</pubDate>
		<dc:creator><![CDATA[noocyte]]></dc:creator>
				<category><![CDATA[Geek]]></category>
		<category><![CDATA[entity framework]]></category>
		<category><![CDATA[orm]]></category>
		<category><![CDATA[performance]]></category>

		<guid isPermaLink="false">http://blog.noocyte.net/?p=662</guid>
		<description><![CDATA[In one of my projects, actually Proactimas project, I’m using Entity Framework (EF) on top of SQL Azure and it works pretty well; data access is relatively fast, dead easy most of the time and the cost (in $) is OK. However I have discovered how sensitive EF is to how you write your queries. &#8230; <a href="http://blog.noocyte.net/2012/09/07/orms-and-performance/" class="more-link">Continue reading <span class="screen-reader-text">ORMs and Performance</span> <span class="meta-nav">&#8594;</span></a>]]></description>
				<content:encoded><![CDATA[<p>In one of my projects, actually <a href="http://proactima.no/">Proactimas</a> project, I’m using <a href="http://msdn.microsoft.com/en-us/data/ef.aspx">Entity Framework</a> (EF) on top of <a href="http://www.windowsazure.com/home/features/data-management/">SQL Azure</a> and it works pretty well; data access is relatively fast, dead easy most of the time and the cost (in $) is OK. However I have discovered how sensitive EF is to how you write your queries. It appears to be especially true if you have several one-to-many relationships. </p>
<p>Just a quick introduction to Proactima Compliance; Any user has access to one or more companies, each company consists of one or more units. Units can be things like ‘Head Office’, IT-department, a ship etc. For every unit there can be one or more evaluations and each evaluation is based on a set of rules that the company measure compliance against. An example of a ruleset is the <a href="http://www.npd.no/en/Regulations/Acts/Petroleum-activities-act/">Petroleum Activities Act</a> in Norway. </p>
<p>In <a href="http://www.proactima.no">Proactima</a> Compliance the most frequently accessed page had an action that took about 1000ms to complete. This page allows the user to evaluate a rule and then choose ‘Save and Next’; so there are two actions involved:</p>
<ol>
<li>Save current rule and find next based on previous rules’ sequence
<li>Load next rule and display it to the user</li>
</ol>
<p>The second action completes in 200-400ms, but the first takes from 800-1200 ms to complete. The main reason for the long processing time is what <a href="http://miniprofiler.com/">MiniProfiler</a> calls Duplicate Readers. Basically, because of the way I had written my queries it was executing a reader querying for each rule in a ruleset! It looked like this:</p>
<p><a href="http://blog.noocyte.net/wp-content/uploads/2012/09/Pre_Optimize.png"><img title="Pre_Optimize" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="Pre_Optimize" src="http://blog.noocyte.net/wp-content/uploads/2012/09/Pre_Optimize_thumb.png" width="590" height="144"></a></p>
<p>It’s running 103 (!) queries just for that one action, that’s terrible! The actual query looked like this:</p>
<pre class="brush: c-sharp; toolbar: false">var rules = from r in evaluationRule.Evaluation.Rules
                 where r.Rule.Sequence &gt; currentSequence 
                 orderby r.Rule.Sequence 
                 select r;</pre>
<p>The variable ‘evaluationRule’ was already fetched from the database and so I was just navigating to its Evaluation (remember how an evaluation is based on a ruleset which in turn consists of individual rules) and then the ruleset for that evaluation. Then I set up the where clause to make sure we can only get a rule with a sequence higher than the current rule. Finally I do an order by and select, from this I will only choose the first rule thus getting the next rule based on sequence. Possible bug here; sequences could potentially be same, but I’m 100% in control of the sequences so that’s really not an issue.</p>
<p>I won’t show the rendered query from this, it’s a nightmare, but the end result is correct and dead slow… So I had to fix this! I tried to manipulate the query in a try-fail-retry pattern; no success at all! I figured after awhile that I was addressing the issue from the wrong end; I was just thinking of the code. Thinking back on previous issues I’ve had with generated Sql (from other ORMs) I remembered (finally!) an old lesson; start by writing the query manually in the best possible way you can and <em>then</em> try to express that same query using the ORM! So that’s what I did! I fired up <a href="http://www.microsoft.com/en-us/download/details.aspx?id=22985">Sql Server Management Studio Express 2012 Deluxe Gold Plated Edition</a>, or whatever it’s called and thought really hard about what I <strong>really</strong> needed. What I ended up with was this:</p>
<pre class="brush: sql; toolbar: false">DECLARE @currentSequence int = 1;
DECLARE @currentEvaluation int = 1;

select	top 1 er.ID, 
	er.RuleID,
	r.Sequence,
	er.EvaluationID
from	EvaluationRules er,
	Rules r
where	er.RuleID = r.ID
and	er.EvaluationID = @currentEvaluation
and	r.Sequence &gt; @currentSequence
order by r.Sequence;</pre>
<p>Not that hard to write at all. Now all I needed was to convert it to EF code:</p>
<pre class="brush: c-sharp; toolbar: false">var rules =
    (from er in Database.EvaluationRules
        join r in Database.Rules on er.RuleID equals r.ID
        where er.EvaluationID == evaluationId
        &amp;&amp; r.Sequence &gt; currentSequence
        orderby r.Sequence
        select er)
        .Take(1);</pre>
<p>It’s definitely a bit more than my original code based query, but as you can see it looks a whole lot like the manual sql query. And how does MiniProfiler now report on my page:</p>
<p><a href="http://blog.noocyte.net/wp-content/uploads/2012/09/Post_Optimize.png"><img title="Post_Optimize" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="Post_Optimize" src="http://blog.noocyte.net/wp-content/uploads/2012/09/Post_Optimize_thumb.png" width="574" height="136"></a><br /><em>Please ignore the minor differences (controller name); I have done some other refactoring&#8217;s as well as the query.</em></p>
<p>What an amazing change! 900ms to 222ms! And 100+ queries to just 7! That’s performance optimizations the user notices! </p>
<p>But why did it all go so terribly wrong in the first place? I’m not going to over analyze the two queries or discuss how EF generates the Sql; somebody much smarter than me can probably do that (or has!). But what I learned from all this is that my old skills as Sql developer isn’t lost even if I am using an ORM AND the way you express a query can matter a whole lot when it comes to performance! </p>
]]></content:encoded>
			<wfw:commentRss>http://blog.noocyte.net/2012/09/07/orms-and-performance/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Yossi Dahan [BizTalk]: Fun with Message Creation in BizTalk</title>
		<link>http://blog.noocyte.net/2008/10/13/yossi-dahan-biztalk-fun-with-message-creation-in-biztalk/</link>
		<comments>http://blog.noocyte.net/2008/10/13/yossi-dahan-biztalk-fun-with-message-creation-in-biztalk/#comments</comments>
		<pubDate>Mon, 13 Oct 2008 06:43:09 +0000</pubDate>
		<dc:creator><![CDATA[noocyte]]></dc:creator>
				<category><![CDATA[Geek]]></category>
		<category><![CDATA[Link]]></category>
		<category><![CDATA[Biztalk]]></category>
		<category><![CDATA[performance]]></category>

		<guid isPermaLink="false">http://noocyte.wordpress.com/2008/10/13/yossi-dahan-biztalk-fun-with-message-creation-in-biztalk/</guid>
		<description><![CDATA[Creating messages is a mess in BizTalk, I really can’t understand why Microsoft doesn’t have a better story on this subject. But at least now we all know which is the most efficient (fast) way to create a message. Well done Yossi. Yossi Dahan [BizTalk]: Fun with Message Creation in BizTalk]]></description>
				<content:encoded><![CDATA[<p>Creating messages is a mess in BizTalk, I really can’t understand why Microsoft doesn’t have a better story on this subject. But at least now we all know which is the most efficient (fast) way to create a message. Well done Yossi.</p>
<p><a href="http://www.sabratech.co.uk/blogs/yossidahan/2008/10/fun-with-message-creation-in-biztalk.html">Yossi Dahan [BizTalk]: Fun with Message Creation in BizTalk</a></p>
]]></content:encoded>
			<wfw:commentRss>http://blog.noocyte.net/2008/10/13/yossi-dahan-biztalk-fun-with-message-creation-in-biztalk/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>TFS Performance &amp; Excel 2007 Heat Map « Grant Holliday</title>
		<link>http://blog.noocyte.net/2008/02/27/tfs-performance-excel-2007-heat-map-grant-holliday/</link>
		<comments>http://blog.noocyte.net/2008/02/27/tfs-performance-excel-2007-heat-map-grant-holliday/#comments</comments>
		<pubDate>Wed, 27 Feb 2008 08:42:35 +0000</pubDate>
		<dc:creator><![CDATA[noocyte]]></dc:creator>
				<category><![CDATA[Geek]]></category>
		<category><![CDATA[Link]]></category>
		<category><![CDATA[performance]]></category>
		<category><![CDATA[tfs]]></category>

		<guid isPermaLink="false">http://noocyte.wordpress.com/2008/02/27/tfs-performance-excel-2007-heat-map-grant-holliday/</guid>
		<description><![CDATA[Looking forward to TFS2008!&#160; TFS Performance &#38; Excel 2007 Heat Map « Grant Holliday]]></description>
				<content:encoded><![CDATA[<p>Looking forward to TFS2008!&nbsp; </p>
<p><a href="http://ozgrant.com/2008/02/26/tfs-performance-excel-2007-heat-map/">TFS Performance &amp; Excel 2007 Heat Map « Grant Holliday</a></p>
]]></content:encoded>
			<wfw:commentRss>http://blog.noocyte.net/2008/02/27/tfs-performance-excel-2007-heat-map-grant-holliday/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Making the Most Out of the SQL Server 2005 Performance Dashboard</title>
		<link>http://blog.noocyte.net/2008/02/25/making-the-most-out-of-the-sql-server-2005-performance-dashboard/</link>
		<comments>http://blog.noocyte.net/2008/02/25/making-the-most-out-of-the-sql-server-2005-performance-dashboard/#comments</comments>
		<pubDate>Mon, 25 Feb 2008 10:59:27 +0000</pubDate>
		<dc:creator><![CDATA[noocyte]]></dc:creator>
				<category><![CDATA[Geek]]></category>
		<category><![CDATA[Link]]></category>
		<category><![CDATA[performance]]></category>
		<category><![CDATA[sql server]]></category>
		<category><![CDATA[vmware]]></category>

		<guid isPermaLink="false">http://noocyte.wordpress.com/2008/02/25/making-the-most-out-of-the-sql-server-2005-performance-dashboard/</guid>
		<description><![CDATA[I&#8217;ve used this to identify our performance problems; looks like VMWare is the culprit.&#160; Making the Most Out of the SQL Server 2005 Performance Dashboard]]></description>
				<content:encoded><![CDATA[<p>I&#8217;ve used this to identify our performance problems; looks like VMWare is the culprit.&nbsp; </p>
<p><a href="http://www.sql-server-performance.com/articles/per/bm_performance_dashboard_2005_p1.aspx">Making the Most Out of the SQL Server 2005 Performance Dashboard</a></p>
]]></content:encoded>
			<wfw:commentRss>http://blog.noocyte.net/2008/02/25/making-the-most-out-of-the-sql-server-2005-performance-dashboard/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>John Rayner&#8217;s Blog : Design-time perf improvements in Visual Studio 2008</title>
		<link>http://blog.noocyte.net/2008/02/01/john-rayners-blog-design-time-perf-improvements-in-visual-studio-2008/</link>
		<comments>http://blog.noocyte.net/2008/02/01/john-rayners-blog-design-time-perf-improvements-in-visual-studio-2008/#comments</comments>
		<pubDate>Fri, 01 Feb 2008 08:34:43 +0000</pubDate>
		<dc:creator><![CDATA[noocyte]]></dc:creator>
				<category><![CDATA[Geek]]></category>
		<category><![CDATA[Link]]></category>
		<category><![CDATA[performance]]></category>
		<category><![CDATA[visual studio]]></category>

		<guid isPermaLink="false">http://noocyte.wordpress.com/?p=126</guid>
		<description><![CDATA[Sweet! &#160; Link to John Rayner&#8217;s Blog : Design-time perf improvements in Visual Studio 2008]]></description>
				<content:encoded><![CDATA[<p>Sweet! <img src="http://blog.noocyte.net/wp-includes/images/smilies/simple-smile.png" alt=":)" class="wp-smiley" style="height: 1em; max-height: 1em;" />&nbsp;</p>
<p><a href="http://blogs.conchango.com/johnrayner/archive/2008/01/28/Design_2D00_time-perf-improvements-in-Visual-Studio-2008.aspx">Link to John Rayner&#8217;s Blog : Design-time perf improvements in Visual Studio 2008</a></p>
]]></content:encoded>
			<wfw:commentRss>http://blog.noocyte.net/2008/02/01/john-rayners-blog-design-time-perf-improvements-in-visual-studio-2008/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Tip/Trick: Hard Drive Speed and Visual Studio Performance &#8211; ScottGu&#8217;s Blog</title>
		<link>http://blog.noocyte.net/2007/11/01/tiptrick-hard-drive-speed-and-visual-studio-performance-scottgus-blog/</link>
		<comments>http://blog.noocyte.net/2007/11/01/tiptrick-hard-drive-speed-and-visual-studio-performance-scottgus-blog/#comments</comments>
		<pubDate>Thu, 01 Nov 2007 12:13:59 +0000</pubDate>
		<dc:creator><![CDATA[noocyte]]></dc:creator>
				<category><![CDATA[Geek]]></category>
		<category><![CDATA[Link]]></category>
		<category><![CDATA[development]]></category>
		<category><![CDATA[performance]]></category>
		<category><![CDATA[visual studio]]></category>

		<guid isPermaLink="false">http://noocyte.wordpress.com/2007/11/01/tiptrick-hard-drive-speed-and-visual-studio-performance-scottgus-blog/</guid>
		<description><![CDATA[&#160; Link to Tip/Trick: Hard Drive Speed and Visual Studio Performance &#8211; ScottGu&#8217;s Blog]]></description>
				<content:encoded><![CDATA[<p>&nbsp;</p>
<p><a href="http://weblogs.asp.net/scottgu/archive/2007/11/01/tip-trick-hard-drive-speed-and-visual-studio-performance.aspx">Link to Tip/Trick: Hard Drive Speed and Visual Studio Performance &#8211; ScottGu&#8217;s Blog</a></p>
]]></content:encoded>
			<wfw:commentRss>http://blog.noocyte.net/2007/11/01/tiptrick-hard-drive-speed-and-visual-studio-performance-scottgus-blog/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
